{% extends "index.html" %}

{% block title %}Manage Systems{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1>Manage Systems</h1>

    <!-- System Form -->
    <form method="post" action="{{ url_for('manage_systems') }}">
        <input type="hidden" id="system_id" name="system_id" value="">
        <div class="mb-3">
            <label for="device_number" class="form-label">Device Number:</label>
            <input type="text" class="form-control" id="device_number" name="device_number" required>
        </div>
        <div class="mb-3">
            <label for="description" class="form-label">Description:</label>
            <input type="text" class="form-control" id="description" name="description">
        </div>
        <div class="mb-3">
            <label for="plc_ip" class="form-label">PLC IP Address:</label>
            <input type="text" class="form-control" id="plc_ip" name="plc_ip" required>
        </div>
        <div class="mb-3">
            <label for="subnet" class="form-label">Subnet:</label>
            <input type="text" class="form-control" id="subnet" name="subnet">
        </div>
        <button type="submit" class="btn btn-primary w-100">Save System</button>
    </form>

    <!-- Existing Systems -->
    <h2 class="mt-5">Existing Systems</h2>
    <ul class="list-group">
        {% for system in systems %}
        <li class="list-group-item d-flex justify-content-between align-items-start">
            <div class="flex-grow-1 w-100">
                <strong>{{ system['device_number'] }}</strong> - {{ system['description'] }} <br> {{ system['plc_ip'] }} <br> {{ system['subnet'] }}
            </div>
            <div class="d-flex flex-column align-items-start" style="width: 100px;">
                <button class="btn btn-sm btn-warning mb-2" style="width: 100%;" onclick="editSystem({{ system['id'] }}, '{{ system['device_number'] }}', '{{ system['description'] }}', '{{ system['plc_ip'] }}', '{{ system['subnet'] }}')">Edit</button>
                <form method="post" action="{{ url_for('delete_system', id=system['id']) }}" style="width: 100%;">
                    <button type="submit" class="btn btn-sm btn-danger" style="width: 100%;">Delete</button>
                </form>
            </div>
        </li>
        {% endfor %}
    </ul>
</div>

<script>
    function editSystem(id, deviceNumber, description, plcIp, subnet) {
        document.getElementById('system_id').value = id;
        document.getElementById('device_number').value = deviceNumber;
        document.getElementById('description').value = description;
        document.getElementById('plc_ip').value = plcIp;
        document.getElementById('subnet').value = subnet;
    }
</script>
{% endblock %}
