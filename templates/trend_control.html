{% extends "index.html" %}

{% block title %}Trend Control{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1>Trend Control</h1>
    
    <!-- Trend Data Entry Form -->
    <form method="post" action="{{ url_for('trend_control') }}">
        <div class="mb-3">
            <label for="system_id" class="form-label">Select System:</label>
            <select class="form-select" id="system_id" name="system_id" required>
                {% for system in systems %}
                <option value="{{ system['id'] }}">{{ system['device_number'] }} - {{ system['description'] }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="mb-3">
            <label for="tag_set_id" class="form-label">Select Tag Set:</label>
            <select class="form-select" id="tag_set_id" name="tag_set_id" required>
                {% for tag_set in tag_sets %}
                <option value="{{ tag_set['id'] }}">{{ tag_set['tag_set_name'] }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="mb-3">
            <label for="cycles" class="form-label">Cycles:</label>
            <input type="number" class="form-control" id="cycles" name="cycles" required>
        </div>
        <div class="mb-3">
            <label for="cycle_time" class="form-label">Cycle Time (ms):</label>
            <input type="number" class="form-control" id="cycle_time" name="cycle_time" step="0.1" required>
        </div>
        <div class="mb-3">
            <label for="buffer_size" class="form-label">Buffer Size:</label>
            <input type="number" class="form-control" id="buffer_size" name="buffer_size" required>
        </div>
        <button type="submit" class="btn btn-primary">Save Trend</button>
    </form>

    <!-- Existing Trends Section -->
    <h2 class="mt-5">Existing Trends</h2>
    <ul class="list-group">
        {% for trend in trends %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
                <strong>{{ trend['device_number'] }}</strong> - {{ trend['description'] }} 
                <br> IP: {{ trend['plc_ip'] }} / Subnet: {{ trend['subnet'] }}
                <br> Cycles: {{ trend['cycles'] }} / Cycle Time: {{ trend['cycle_time'] }} ms / Buffer Size: {{ trend['buffer_size'] }}
                <br> Tags: {{ trend['tags'] }}
                
            </div>
            <div>
                <a href="{{ url_for('edit_trend', id=trend['id']) }}" class="btn btn-sm btn-warning">Edit</a>
                <form method="post" action="{{ url_for('delete_trend', id=trend['id']) }}" style="display:inline;">
                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                </form>
            </div>
        </li>
        {% endfor %}
    </ul>
</div>
{% endblock %}
